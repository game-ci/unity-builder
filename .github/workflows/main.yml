name: Actions ðŸ˜Ž

on:
  pull_request: {}
  push: { branches: [master] }

env:
  UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
  PROJECT_PATH: test-project
  UNITY_PROJECT_PATH: test-project

jobs:
  activate:
    name: Activate Unity
    runs-on: ubuntu-latest
    steps:
      - uses: webbertakken/unity-activate@v1

  test:
    name: Test the project
    needs: [checkout, activate]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: webbertakken/unity-test-runner@master
        env:
          TEST_MODE: all

  buildForWebGL:
    name: Build for WebGL
    needs: [test]
    runs-on: ubuntu-latest
    steps: # webbertakken/unity-builder@v0.3-webgl
      - uses: actions/checkout@v1
      - uses: ./

  buildForAndroid:
    name: Build for Android
    needs: [test]
    runs-on: ubuntu-latest
    steps: # webbertakken/unity-builder@v0.3-android
      - uses: actions/checkout@v1
      - uses: ./

  uploadBuildArtifacts:
    name: Upload Build Artifacts
    needs:
      - buildForWebGL
      - buildForAndroid
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: actions/upload-artifact@v1
        with:
          name: Builds
          path: builds

  returnTheLicense:
    name: Return the license
    needs: [uploadBuildArtifacts]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: webbertakken/unity-return-license@v1
